#!/bin/sh

indent() {
  sed -u 's/^/       /'
}

echo "-----> Building jekyll site"

env PATH=$PATH JEKYLL_ENV=production bundle exec rake build 2>&1

if [ $? -ne 0 ]; then
  echo "Failed to build site with jekyll."
fi

echo "-----> Purge Fastly cache"

env PATH=$PATH curl -X POST -H "Fastly-Key:ENV['FASTLY_API_KEY']" "https://api.fastly.com/service/ENV['FASTLY_SERVICE_ID']/purge_all"

if [ $? -ne 0 ]; then
  echo "Failed to purge fastly cache."
fi
